<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Kitchen Label — v3 (Premium QSR)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />

<!-- libs -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
  :root{ --label-width-mm:50.8mm; --accent:#0b76ff; --muted:#6b7280 }
  body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background:#f3f6fb; margin:18px}
  .wrap{max-width:1024px;margin:0 auto;display:flex;gap:22px}
  .controls{flex:1;background:#fff;padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(12,20,60,0.06)}
  .preview{width:calc(var(--label-width-mm) + 32px);background:#fff;padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(12,20,60,0.06)}
  h1{font-size:18px;margin:0 0 10px}
  label{display:block;margin-top:10px;font-weight:600;color:#111}
  input,select{width:100%;padding:10px;border:1px solid #e6eef8;border-radius:8px;margin-top:8px;font-size:15px}
  .row{display:flex;gap:8px;margin-top:8px}
  .row .col{flex:1}
  .btn{display:inline-block;padding:10px 14px;background:var(--accent);color:white;border-radius:8px;border:none;cursor:pointer;margin-top:12px}
  .btn.ghost{background:#111827;color:white}
  .muted{color:var(--muted);font-size:13px;margin-top:8px}
  .label-canvas{width:var(--label-width-mm);background:white;border:1px solid #eee;padding:8px;box-sizing:border-box}
  .label-inner{font-family:'Helvetica Neue', Arial, sans-serif; font-size:12px;color:#111;padding:6px}

  /* PREMIUM QSR STYLING */
  .brand-row{display:flex;align-items:center;gap:8px}
  .brand-mark{width:32px;height:32px;border-radius:6px;background:linear-gradient(135deg,#0b76ff,#06b6d4);display:flex;align-items:center;justify-content:center;color:white;font-weight:800}
  .brand-name{font-weight:800;font-size:13px}
  .divider{height:1px;background:#f1f5f9;margin:8px 0}

  .lbl-heading{text-align:center;font-weight:700;font-size:11px;color:#111}
  .lbl-item{font-weight:900;font-size:18px;margin:6px 0}
  .lbl-meta{font-size:11px;color:#111;margin:3px 0}
  .lbl-timestamp{font-weight:800;color:#111}
  .lbl-small{font-size:10px;color:var(--muted)}
  .lbl-qr{float:right;margin-top:-6px}

  .footer-note{font-size:10px;color:var(--muted);text-align:center;margin-top:6px}

  /* print rules: fit to label width */
  @media print{
    @page{size:50.8mm auto;margin:0}
    body *{visibility:hidden}
    #printArea, #printArea *{visibility:visible}
    #printArea{position:absolute;left:0;top:0}
  }
</style>
</head>
<body>
  <div style="max-width:1100px;margin:10px auto">
    <h1>Kitchen Label — Premium QSR (v3)</h1>
    <div class="wrap">
      <div class="controls">
        <label>Item</label>
        <input id="item" value="Paneer Butter Masala" />

        <label>Station</label>
        <select id="station"><option>Hot Kitchen</option><option>Cold Kitchen</option><option>Tandoor</option><option>Bakery</option></select>

        <div class="row">
          <div class="col">
            <label>Shelf life (hrs)</label>
            <input id="shelf" value="24" />
          </div>
          <div class="col">
            <label>Copies</label>
            <input id="copies" value="1" />
          </div>
        </div>

        <label>Batch / Notes (optional)</label>
        <input id="notes" placeholder="Batch 2301 • Chef: Rahul" />

        <div style="margin-top:12px">
          <button id="previewBtn" class="btn">Preview</button>
          <button id="downloadPdfBtn" class="btn ghost">Download High-res PDF</button>
          <button id="downloadPngBtn" class="btn" style="background:#374151">Download PNG</button>
        </div>

        <div class="muted">Tip: press <strong>Preview</strong> to update label, then <strong>Download High-res PDF</strong> for sharp output suitable for proofing or printing as an image.</div>
      </div>

      <div class="preview">
        <div style="text-align:center;margin-bottom:10px"><strong>Live Label Preview (2")</strong></div>
        <div id="labelWrapper" class="label-canvas">
          <div id="labelInner" class="label-inner">
            <!-- rendered label content -->
          </div>
        </div>
        <div class="muted" style="margin-top:8px">Label width: <strong>50.8mm</strong>. Timestamps are bold for quick scanning.</div>
      </div>
    </div>
  </div>

  <!-- hidden print area used by print css -->
  <div id="printArea" style="display:none;">
    <div id="labelForPrint" class="label-canvas">
      <div class="label-inner" id="labelInnerPrint"></div>
    </div>
  </div>

<script>
(function(){
  const itemEl = document.getElementById('item');
  const stationEl = document.getElementById('station');
  const shelfEl = document.getElementById('shelf');
  const copiesEl = document.getElementById('copies');
  const notesEl = document.getElementById('notes');
  const previewBtn = document.getElementById('previewBtn');
  const downloadPdfBtn = document.getElementById('downloadPdfBtn');
  const downloadPngBtn = document.getElementById('downloadPngBtn');
  const labelInner = document.getElementById('labelInner');
  const labelInnerPrint = document.getElementById('labelInnerPrint');
  const labelWrapper = document.getElementById('labelWrapper');

  function fmtDate(d){ const dd=String(d.getDate()).padStart(2,'0'); const mm=String(d.getMonth()+1).padStart(2,'0'); const hh=String(d.getHours()).padStart(2,'0'); const mn=String(d.getMinutes()).padStart(2,'0'); return dd+'/'+mm+' '+hh+':'+mn; }

  function buildLabelHtml(item, station, prepISO, shelfHours, notes){
    const prep = new Date(prepISO);
    const expiry = new Date(prep.getTime() + shelfHours*3600*1000);
    const qrPlaceholder = '<svg width="56" height="56" xmlns="http://www.w3.org/2000/svg"><rect width="56" height="56" fill="#f3f4f6"/></svg>';

    return `
      <div class="brand-row">
        <div class="brand-mark">KS</div>
        <div style="margin-left:6px"><div class="brand-name">Kulcha Singh</div><div class="lbl-small">Kitchen Label</div></div>
      </div>
      <div class="divider"></div>
      <div class="lbl-heading">*** KITCHEN LABEL ***</div>
      <div style="display:flex;gap:8px;align-items:flex-start">
        <div style="flex:1">
          <div class="lbl-item">${escapeHtml(item)}</div>
          <div class="lbl-meta">Station: ${escapeHtml(station)}</div>
          <div class="lbl-meta"><span class="lbl-timestamp">Prep: ${fmtDate(prep)}</span></div>
          <div class="lbl-meta"><span class="lbl-timestamp">Use by: ${fmtDate(expiry)}</span></div>
          ${notes?('<div class="lbl-meta small">'+escapeHtml(notes)+'</div>') : ''}
        </div>
        <div class="lbl-qr">${qrPlaceholder}</div>
      </div>
      <div class="footer-note">Printed by Kulcha Singh • FIFO</div>
    `;
  }

  function escapeHtml(s){ return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

  previewBtn.addEventListener('click', ()=>{
    const item = itemEl.value.trim() || 'Item';
    const station = stationEl.value;
    const shelf = parseInt(shelfEl.value||'24',10);
    const notes = notesEl.value.trim();
    const now = new Date().toISOString();
    const html = buildLabelHtml(item, station, now, shelf, notes);
    labelInner.innerHTML = html;
    labelInnerPrint.innerHTML = html;
    document.getElementById('printArea').style.display = 'block';
  });

  // high-res PDF generation
  downloadPdfBtn.addEventListener('click', async ()=>{
    if(!labelInner.innerHTML.trim()) previewBtn.click();
    const copies = Math.max(1, parseInt(copiesEl.value||'1',10));
    try{
      const scale = 3; // high DPI
      const canvas = await html2canvas(labelWrapper, {backgroundColor:'#ffffff', scale});
      const { jsPDF } = window.jspdf;
      const mmWidth = 50.8;
      const pageHeightMm = (canvas.height/canvas.width) * mmWidth;
      const pdf = new jsPDF({unit:'mm', format:[mmWidth, pageHeightMm]});
      const img = canvas.toDataURL('image/png');
      for(let i=0;i<copies;i++){
        if(i>0) pdf.addPage([mmWidth, pageHeightMm]);
        pdf.addImage(img, 'PNG', 0, 0, mmWidth, pageHeightMm);
      }
      const filename = 'label-'+new Date().toISOString().slice(0,19).replaceAll(':','-')+'.pdf';
      pdf.save(filename);
      alert('Saved PDF: '+filename);
    }catch(e){ console.error(e); alert('PDF failed: '+e); }
  });

  downloadPngBtn.addEventListener('click', async ()=>{
    if(!labelInner.innerHTML.trim()) previewBtn.click();
    try{
      const canvas = await html2canvas(labelWrapper, {backgroundColor:'#ffffff', scale:3});
      const link = document.createElement('a');
      link.href = canvas.toDataURL('image/png');
      link.download = 'label-'+new Date().toISOString().slice(0,19).replaceAll(':','-')+'.png';
      link.click();
    }catch(e){ console.error(e); alert('PNG failed: '+e); }
  });

  // initial preview
  previewBtn.click();
})();
</script>
</body>
</html>
